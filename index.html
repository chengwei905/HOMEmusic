<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>HOMEmusic 播放器</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 2em; }
    #player { background: #fff; padding: 1em; border-radius: 8px; box-shadow: 0 0 10px #ccc; }
    audio { width: 100%; margin-top: 1em; }
    select, button { width: 100%; padding: 0.5em; margin-top: 1em; }
  </style>
</head>
<body>
  <div id="player">
    <h2>🎵 HOMEmusic 播放器</h2>

    <!-- 播放清單來源選擇 -->
    <label for="sourceSelector">選擇播放清單格式：</label>
    <select id="sourceSelector">
      <option value="json">JSON 播放清單</option>
      <option value="m3u">M3U 播放清單</option>
    </select>

    <!-- 曲目選擇 -->
    <label for="trackSelector">選擇曲目：</label>
    <select id="trackSelector"></select>

    <!-- 播放器與控制 -->
    <audio id="audio" controls></audio>
    <button onclick="playNext()">下一首 ▶️</button>
  </div>

  <script>
    let playlist = [];
    let currentTrack = 0;

    async function loadPlaylist() {
      const format = document.getElementById('sourceSelector').value;
      const path = format === 'json' ? 'music/playlist.json' : 'music/playlist.m3u';
      format === 'json' ? await loadJSONPlaylist(path) : await loadM3UPlaylist(path);
    }

    async function loadJSONPlaylist(url) {
      try {
        const res = await fetch(url);
        const files = await res.json();
        playlist = files.map(file => 'music/' + file);
        renderTrackSelector();
        playTrack(0);
      } catch (err) {
        console.error('載入 JSON 播放清單失敗', err);
      }
    }

    async function loadM3UPlaylist(url) {
      try {
        const res = await fetch(url);
        const text = await res.text();
        const lines = text.split('\n').map(line => line.trim()).filter(line => line && !line.startsWith('#'));
        playlist = lines.map(line => 'music/' + line);
        renderTrackSelector();
        playTrack(0);
      } catch (err) {
        console.error('載入 M3U 播放清單失敗', err);
      }
    }

    function renderTrackSelector() {
      const selector = document.getElementById('trackSelector');
      selector.innerHTML = '';
      playlist.forEach((track, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = track.split('/').pop();
        selector.appendChild(option);
      });
      selector.onchange = () => playTrack(parseInt(selector.value));
    }

    function playTrack(index) {
      currentTrack = index;
      const audio = document.getElementById('audio');
      audio.src = playlist[index];
      audio.play();
      document.getElementById('trackSelector').value = index;
    }

    function playNext() {
      currentTrack = (currentTrack + 1) % playlist.length;
      playTrack(currentTrack);
    }

    // 初始化與切換來源事件
    window.onload = () => {
      document.getElementById('sourceSelector').onchange = loadPlaylist;
      loadPlaylist();
    };
  </script>
</body>
</html>

